<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Trip to Hokkaido 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#F0FFFF',
                        'ice-blue': '#B3E5FC',
                        'light-snow-blue': '#E5F3F7',
                        'deep-sea-blue': '#01579B',
                        'accent-yellow': '#FFD54F',
                        'soft-gray': '#F5F5F5'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            background-color: #E5F3F7; 
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff; 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }

        .header-bg {
            background-color: #ffffff; 
            padding: 0; 
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15); 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
            z-index: 10; 
        }
        
        .header-image-container {
            width: 100%;
            height: 250px; 
            overflow: hidden;
            background-color: #f0f0f0; 
            border-bottom-left-radius: 35px; 
            border-bottom-right-radius: 35px;
        }
        
        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block; 
        }
        
        .snow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23fff" opacity="0.8"/><circle cx="20" cy="80" r="0.5" fill="%23fff" opacity="0.6"/><circle cx="70" cy="30" r="1.5" fill="%23fff" opacity="0.9"/></svg>');
            background-size: 100px 100px;
            opacity: 0.7;
            animation: snowfall 10s linear infinite;
            z-index: 5;
        }

        @keyframes snowfall {
            to { background-position: 100px 100px; }
        }
        
        .side-tab-bar {
            position: absolute;
            bottom: 45px; 
            right: 16px;
            z-index: 30;
            display: flex;
            flex-direction: row;
            gap: 8px; 
        }
        
        .tab-button {
            width: 40px; 
            height: 40px;
            border-radius: 9999px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); 
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background-color: #01579B;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(1, 87, 155, 0.4); 
            transform: scale(1.05);
        }
        
        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #B3E5FC;
        }

        .app-main {
            padding-top: 25px !important; 
            position: relative;
            z-index: 5;
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .card-shadow {
            box-shadow: 0 4px 20px rgba(179, 229, 252, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fab-shadow { box-shadow: 0 4px 15px rgba(255, 213, 79, 0.5); }

        .note-content {
            max-height: 2.5rem;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .note-content.expanded { max-height: 500px; }
        
        .expense-category-tag {
            min-width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .expenses-banner {
            background: linear-gradient(135deg, #01579B 0%, #0097A7 100%);
        }
        
        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0; 
            z-index: 20; 
            top: 0; 
        }
    </style>
</head>
<body>

<div id="app" class="app-container">
    <div class="header-bg relative">
        <div class="header-image-container">
            <img src="IMG_4330.PNG" alt="北海道家族旅行計畫" onerror="this.src='https://images.unsplash.com/photo-1549608276-5786d7ff1f1d?q=80&w=800&auto=format&fit=crop'">
        </div>
        
        <div class="snow-layer"></div> 
        
        <div class="side-tab-bar">
            <button @click="currentTab = 'itinerary'" :class="{'active': currentTab === 'itinerary'}" class="tab-button">
                <i class="fa-solid fa-map-location-dot"></i>
            </button>
            <button @click="currentTab = 'info'" :class="{'active': currentTab === 'info'}" class="tab-button">
                <i class="fa-solid fa-circle-info"></i>
            </button>
            <button @click="currentTab = 'shopping'" :class="{'active': currentTab === 'shopping'}" class="tab-button">
                <i class="fa-solid fa-basket-shopping"></i>
            </button>
            <button @click="currentTab = 'expenses'" :class="{'active': currentTab === 'expenses'}" class="tab-button">
                <i class="fa-solid fa-coins"></i>
            </button>
        </div>
    </div>

    <main class="p-4 app-main">
        <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
            <div class="flex overflow-x-auto hide-scrollbar space-x-3 pb-4 mb-2 snap-x sticky date-selector-sticky pt-1 -mx-4 px-4">
                <div v-for="(day, index) in dates" :key="index" 
                     @click="selectedDateIndex = index"
                     class="snap-center flex-shrink-0 w-[58px] h-[68px] rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2 shadow-sm"
                     :class="selectedDateIndex === index ? 'bg-deep-sea-blue text-white border-deep-sea-blue shadow-lg scale-105' : 'bg-white text-slate-400 border-white hover:bg-soft-gray'">
                    <span class="text-sm font-bold uppercase tracking-wider">{{ day.weekday }}</span> 
                    <span class="text-xs font-medium opacity-70">{{ day.date }}</span> 
                </div>
            </div>

            <div v-if="weatherData[selectedDateIndex]" class="mb-4 bg-snow-white border border-ice-blue rounded-2xl p-4 flex justify-between items-center shadow-md">
                <div class="flex items-start text-deep-sea-blue space-x-4">
                    <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)" class="text-5xl text-blue-500"></i>
                    <div class="pt-1">
                        <span class="text-3xl font-extrabold leading-none">{{ weatherData[selectedDateIndex].temp.split('/')[0] }}°</span>
                        <span class="text-sm font-light text-slate-500 ml-1">/ {{ weatherData[selectedDateIndex].temp.split('/')[1] }}°C</span>
                        <span class="block text-xs text-slate-600 mt-1">體感: {{ weatherData[selectedDateIndex].feel }}°C</span> 
                    </div>
                </div>
                <div class="text-right text-xs text-slate-600 pl-3">
                    <span class="font-bold block text-slate-700">{{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}</span>
                    <span v-if="dates[selectedDateIndex].hasCar" class="mt-1 block text-deep-sea-blue font-bold">
                        <i class="fa-solid fa-car-side mr-1 text-accent-yellow"></i> 租車日
                    </span>
                </div>
            </div>

            <div class="space-y-4">
                <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group">
                    <div v-if="idx > 0" class="pl-8 pb-2 flex items-center text-xs text-slate-400">
                        <div class="h-6 w-0.5 bg-slate-200 absolute left-6 -top-3"></div>
                        <i :class="getTransportIcon(item.transportType)" class="mr-2 text-slate-300 cursor-pointer hover:text-deep-sea-blue transition-colors" @click="openMapDirections(currentItinerary[idx - 1], item)"></i>
                        <span class="font-bold">{{ item.travelTime || '約 15 分鐘' }}</span>
                    </div>
                    
                    <div class="bg-white rounded-3xl p-5 card-shadow relative overflow-hidden flex items-start border border-ice-blue/50">
                        <div class="mr-4 flex flex-col items-center min-w-[50px]">
                            <div class="p-2 rounded-full text-white shadow-md text-base mb-1" :class="getCategoryColor(item.category)">
                                <i :class="getCategoryIcon(item.category)"></i>
                            </div>
                            <span v-if="item.startTime" class="text-xs font-bold text-slate-600 mt-1">{{ item.startTime }}</span>
                        </div>

                        <div class="flex-1 pb-1">
                            <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight pr-8">{{ item.name }}</h3>
                            <div class="text-sm text-slate-500 space-y-1.5 mt-2">
                                <p v-if="item.hours" class="flex items-center"><i class="fa-regular fa-clock w-4 text-center mr-2 text-ice-blue"></i> {{ item.hours }}</p>
                                <p v-if="item.address" class="flex items-start"><i class="fa-solid fa-location-dot w-4 text-center mr-2 mt-1 text-ice-blue"></i> {{ item.address }}</p>
                            </div>
                            <div v-if="item.note" class="mt-3 text-xs bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                                <div class="note-content" :class="{'expanded': item.isNoteExpanded}">{{ item.note }}</div>
                                <button v-if="item.note.length > 50" @click="item.isNoteExpanded = !item.isNoteExpanded" class="text-deep-sea-blue font-bold mt-1 block">
                                    {{ item.isNoteExpanded ? '收合' : '更多...' }}
                                </button>
                            </div>
                        </div>

                        <div class="absolute top-3 right-3 flex flex-col space-y-1">
                            <button @click.stop="openMap(item.address || item.name)" class="w-7 h-7 bg-ice-blue text-deep-sea-blue rounded-full flex items-center justify-center text-xs hover:bg-deep-sea-blue hover:text-white transition-colors">
                                <i class="fa-solid fa-location-arrow"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'info'" class="space-y-5 animate-fade-in">
            <div class="bg-gradient-to-r from-deep-sea-blue to-cyan-700 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                <h3 class="font-bold text-lg mb-4 flex items-center"><i class="fa-solid fa-calculator mr-2"></i> 匯率換算 (0.215)</h3>
                <div class="flex items-center justify-between space-x-3">
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1">JPY</label>
                        <input type="number" v-model="currencyInput" @input="calculateCurrency" class="w-full bg-white/20 border border-white/30 rounded-xl px-3 py-2 text-white font-bold outline-none">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-cyan-300 mt-5"></i>
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1">TWD</label>
                        <div class="w-full bg-white/10 rounded-xl px-3 py-2 text-white font-bold border border-transparent">$ {{ currencyResult }}</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-slate-800 mb-3 border-b pb-2"><i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i> 航班資訊</h3>
                <div class="space-y-2 text-sm">
                    <div class="bg-blue-50 p-3 rounded-xl">2/1 CI0130 TPE 08:35 ➔ CTS 13:15</div>
                    <div class="bg-orange-50 p-3 rounded-xl">2/7 CI0131 CTS 14:40 ➔ TPE 18:15</div>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'shopping'" class="animate-fade-in">
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="bg-white rounded-2xl p-3 card-shadow">
                    <div class="aspect-square bg-slate-50 rounded-xl mb-2 flex items-center justify-center text-slate-300">
                        <i class="fa-solid fa-bag-shopping text-3xl"></i>
                    </div>
                    <p class="font-bold text-sm text-slate-800 truncate">{{ item.name }}</p>
                </div>
            </div>
        </div>

        <div v-if="currentTab === 'expenses'" class="animate-fade-in">
            <div class="expenses-banner text-white rounded-3xl p-8 mb-6">
                <p class="text-sm text-cyan-200 mb-1">總花費 (JPY)</p>
                <h2 class="text-4xl font-bold">¥ {{ formatNumber(totalExpensesJPY) }}</h2>
                <p class="text-sm opacity-80">約 NT$ {{ formatNumber(totalExpensesTWD) }}</p>
            </div>
        </div>
    </main>

    <button v-if="currentTab !== 'info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-deep-sea-blue text-2xl flex items-center justify-center z-40">
        <i class="fa-solid fa-plus"></i>
    </button>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue

    createApp({
        setup() {
            const EXCHANGE_RATE = 0.215;
            const currentTab = ref('itinerary');
            const selectedDateIndex = ref(0);
            const currencyInput = ref(10000);
            const currencyResult = ref(0);

            const CATEGORY_MAP = {
                sightseeing: { color: 'bg-green-500', icon: 'fa-solid fa-camera' },
                food: { color: 'bg-red-500', icon: 'fa-solid fa-utensils' },
                shopping: { color: 'bg-indigo-500', icon: 'fa-solid fa-bag-shopping' },
                accommodation: { color: 'bg-purple-500', icon: 'fa-solid fa-bed' },
                flight: { color: 'bg-blue-500', icon: 'fa-solid fa-plane-departure' },
                transport: { color: 'bg-orange-500', icon: 'fa-solid fa-car' },
                other: { color: 'bg-slate-500', icon: 'fa-solid fa-circle-info' }
            };

            const dates = ref([
                { date: '2/1', weekday: '五', hasCar: false },
                { date: '2/2', weekday: '六', hasCar: true },
                { date: '2/3', weekday: '日', hasCar: true },
                { date: '2/4', weekday: '一', hasCar: true },
                { date: '2/5', weekday: '二', hasCar: true },
                { date: '2/6', weekday: '三', hasCar: true },
                { date: '2/7', weekday: '四', hasCar: false },
            ]);

            const weatherData = ref([
                { condition: 'snow', temp: '0/-5', feel: '-8' },
                { condition: 'snow', temp: '-1/-7', feel: '-10' },
                { condition: 'snow', temp: '-2/-10', feel: '-12' },
                { condition: 'snow', temp: '-3/-8', feel: '-11' },
                { condition: 'snow', temp: '1/-4', feel: '-6' },
                { condition: 'snow', temp: '2/-3', feel: '-5' },
                { condition: 'cloudy', temp: '3/-2', feel: '-3' },
            ]);

            const itineraryData = ref([
                // Day 1
                [
                    { id: 1, name: '新千歲機場抵達', category: 'flight', startTime: '13:15', address: 'New Chitose Airport', transportType: 'flight', note: '領行李與購買車票' },
                    { id: 2, name: '湯咖哩 GARAKU', category: 'food', startTime: '18:00', address: 'Soup Curry GARAKU', transportType: 'walk', note: '必點燉豬肉湯咖哩' }
                ],
                // Day 2
                [
                    { id: 3, name: '小樽運河', category: 'sightseeing', startTime: '10:00', address: 'Otaru Canal', transportType: 'car', note: '拍照、逛商店街' }
                ]
                // ... 其餘天數可自行補齊
            ]);

            const shoppingList = ref([{ name: '六花亭夾心餅乾' }, { name: 'LeTAO 起司蛋糕' }]);
            const expenses = ref([{ amount: 35000, name: '機票' }]);

            const currentItinerary = computed(() => itineraryData.value[selectedDateIndex.value] || []);
            const totalExpensesJPY = computed(() => expenses.value.reduce((sum, e) => sum + e.amount, 0));
            const totalExpensesTWD = computed(() => Math.round(totalExpensesJPY.value * EXCHANGE_RATE));

            const calculateCurrency = () => { currencyResult.value = Math.round(currencyInput.value * EXCHANGE_RATE); };
            const formatNumber = (num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            const getCategoryColor = (cat) => CATEGORY_MAP[cat]?.color || CATEGORY_MAP.other.color;
            const getCategoryIcon = (cat) => CATEGORY_MAP[cat]?.icon || CATEGORY_MAP.other.icon;
            const getTransportIcon = (type) => ({ walk: 'fa-solid fa-shoe-prints', car: 'fa-solid fa-car-side', flight: 'fa-solid fa-plane' }[type] || 'fa-solid fa-arrow-right');
            const getWeatherIcon = (cond) => ({ snow: 'fa-solid fa-snowflake', cloudy: 'fa-solid fa-cloud' }[cond] || 'fa-solid fa-sun');
            const getWeatherDescription = (cond) => ({ snow: '降雪', cloudy: '多雲' }[cond] || '晴朗');

            const openMap = (query) => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
            const openMapDirections = (start, end) => {
                const s = encodeURIComponent(start.address || start.name);
                const e = encodeURIComponent(end.address || end.name);
                window.open(`https://www.google.com/maps/dir/?api=1&origin=${s}&destination=${e}`, '_blank');
            };

            onMounted(() => calculateCurrency());

            return {
                currentTab, dates, selectedDateIndex, itineraryData, currentItinerary,
                shoppingList, expenses, totalExpensesJPY, totalExpensesTWD,
                weatherData, currencyInput, currencyResult, calculateCurrency,
                getCategoryColor, getCategoryIcon, getWeatherIcon, getTransportIcon, getWeatherDescription,
                openMap, openMapDirections, formatNumber
            };
        }
    }).mount('#app');
</script>
</body>
</html>
